<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
  <link rel="icon" href="images/title.jpeg" type="image/png">
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Sarabun&display=swap" rel="stylesheet">
</head>

<body>
  <header class="header">
    <div class="header-content">
      <img src="images/title.jpeg" class="header-icon" alt="School logo">
      <div>
        <h1 class="title">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
        <p class="subtitle">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•‡∏ß‡∏±‡∏î‡∏´‡∏ô‡∏≠‡∏á‡∏Ç‡∏∏‡∏ô‡∏ä‡∏≤‡∏ï‡∏¥ (‡∏≠‡∏∏‡∏ó‡∏¥‡∏®‡∏û‡∏¥‡∏ó‡∏¢‡∏≤‡∏Ñ‡∏≤‡∏£)</p>
      </div>
    </div>
    <nav class="menu">
      <button class="active">üë§ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      <button onclick="window.location.href='listOverall.html'">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      <button onclick="window.location.href='statistics.html'">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
    </nav>
  </header>
  <div class="container">
    <h2>üìò ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>

    <form id="studentForm">
      <!-- üë©üèª‚Äçüíª ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
      <div class="section-title">üë©üèª‚Äçüíª ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
      <div class="student-info">
        <div class="form-item"><label>‡∏ä‡∏∑‡πà‡∏≠ *</label><input name="firstName" required></div>
        <div class="form-item"><label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label><input name="lastName" required></div>
        <div class="form-item"><label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô *</label><input name="nickname" required></div>
        <div class="form-item"><label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô *</label>
          <select name="grade" required>
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô --</option>
            <option>‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 2</option>
            <option>‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 3</option>
            <option>‡∏õ.1</option>
            <option>‡∏õ.2</option>
            <option>‡∏õ.3</option>
            <option>‡∏õ.4</option>
            <option>‡∏õ.5</option>
            <option>‡∏õ.6</option>
          </select>
        </div>
        <div class="form-item"><label>‡∏´‡πâ‡∏≠‡∏á *</label><input name="room" required></div>
        <div class="form-item"><label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á *</label><input name="parentPhone" required></div>
      </div>

      <div class="address-row">
        <div class="form-item full">
          <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà *</label>
          <textarea name="address" rows="3" required></textarea>
        </div>
      </div>

      <!-- üöó ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á -->
      <div class="section-title">üöó ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</div>
      <div class="travel-info">
        <div class="form-item full">
          <label>‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÇ‡∏î‡∏¢ *</label>
          <select name="transportation" id="transport-select" required>
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á --</option>
            <option>‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</option>
            <option>‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå</option>
            <option>‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
            <option>‡∏£‡∏ñ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ó‡∏≤‡∏á</option>
            <option>‡πÄ‡∏î‡∏¥‡∏ô</option>
            <option>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
          </select>
        </div>
      </div>

      <!-- üîΩ ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏° -->
      <div id="transport-extra-fields" style="display: none;" class="travel-info">
        <div class="form-item">
          <label>üßë‚Äçüíº ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ</label>
          <input type="text" name="vehicleOwner" />
        </div>
        <div class="form-item">
          <label>üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ</label>
          <input type="text" name="ownerPhone" />
        </div>
        <div class="form-item">
          <label>üë®‚Äç‚úàÔ∏è ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ</label>
          <input type="text" name="driverName" />
        </div>
        <div class="form-item">
          <label>üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ</label>
          <input type="text" name="driverPhone" />
        </div>
      </div>

      <!-- üëØ‚Äç‚ôÄÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏™‡∏ô‡∏¥‡∏ó -->
      <div class="section-title">üëØ‚Äç‚ôÄÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏™‡∏ô‡∏¥‡∏ó</div>
      <div class="student-info">
        <div class="form-item"><label>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏™‡∏ô‡∏¥‡∏ó</label><input name="friendName"></div>
        <div class="form-item"><label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label><input name="friendNickname"></div>
        <div class="form-item"><label>‡∏´‡πâ‡∏≠‡∏á</label><input name="friendRoom"></div>
        <div class="form-item"><label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label>
          <select name="friendGrade">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô --</option>
            <option>‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 2</option>
            <option>‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 3</option>
            <option>‡∏õ.1</option>
            <option>‡∏õ.2</option>
            <option>‡∏õ.3</option>
            <option>‡∏õ.4</option>
            <option>‡∏õ.5</option>
            <option>‡∏õ.6</option>
          </select>
        </div>
      </div>

      <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å -->
      <div class="buttons">
        <button type="submit" class="save-btn">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button type="reset" class="cancel-btn">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </form>
  </div>
  <div id="footer-placeholder"></div>

  <script>
    // const urlGG = process.env.NEXT_PUBLIC_GOOGLE_SCRIPT_URL || "https://script.google.com/macros/s/AKfycbzRB8T4-IyLuZR6Q7dJXmTdC1dqfNZSHcXnYCTZpQpahQWmfBMybyfqNfIQH105fgFc/exec"
    const urlGG = "https://script.google.com/macros/s/AKfycbzRB8T4-IyLuZR6Q7dJXmTdC1dqfNZSHcXnYCTZpQpahQWmfBMybyfqNfIQH105fgFc/exec";

    document.getElementById("transport-select").addEventListener("change", function() {
      const showExtra = ["‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß", "‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå", "‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"];
      const selected = this.value;
      const extraFields = document.getElementById("transport-extra-fields");
      extraFields.style.display = showExtra.includes(selected) ? "grid" : "none";
    });

    document.getElementById("studentForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const student = {};
      formData.forEach((value, key) => student[key] = value);
      student.id = Date.now().toString();
      const now = new Date();
      now.setHours(now.getHours() + 7); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤ 7 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (UTC+7)
      student.createdAt = now.toISOString().replace("T", " ").substring(0, 19);

      console.log("üöÄ student payload", student);

      fetch(urlGG, {
          method: "POST",
          headers: {
            "Content-Type": "text/plain"
          },
          body: JSON.stringify({
            action: "add",
            student: student
          })
        })
        .then(res => res.json())
        .then(data => {
          if (data.result === "success") {
            alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
            this.reset();
          } else {
            alert("‚ùå Error: " + data.message);
          }
        })
        .catch(err => {
          alert("‚ùå Network Error");
          console.error(err);
        });
    });

    document.querySelector(".cancel-btn").addEventListener("click", function() {
      if (confirm("‚ùå ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å?")) {
        document.getElementById("studentForm").reset();
      }
    });

    document.querySelector(".active").addEventListener("click", function() {
      alert("üë§ ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô");
    });

    // Load footer
    // Fetch the footer HTML and insert it into the placeholder
    window.addEventListener("DOMContentLoaded", () => {
      fetch("footer.html")
        .then(res => res.ok ? res.text() : Promise.reject("Footer not found"))
        .then(html => {
          document.getElementById("footer-placeholder").innerHTML = html;
        })
        .catch(err => {
          console.error("‚ö†Ô∏è Footer load error:", err);
        });
    });
  </script>
</body>

</html>