<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <title>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <header class="header">
    <div class="header-content">
      <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="student icon" class="header-icon">
      <div>
        <h1 class="title">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
        <p class="subtitle">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•‡∏ß‡∏±‡∏î‡∏´‡∏ô‡∏≠‡∏á‡∏Ç‡∏∏‡∏ô‡∏ä‡∏≤‡∏ï‡∏¥ (‡∏≠‡∏∏‡∏ó‡∏¥‡∏®‡∏û‡∏¥‡∏ó‡∏¢‡∏≤‡∏Ñ‡∏≤‡∏£)</p>
      </div>
    </div>
    <nav class="menu">
      <button onclick="window.location.href='index.html'">üë§ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      <button onclick="window.location.href='listOverall.html'">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      <button class="active" onclick="window.location.href='statistics.html'">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
    </nav>
  </header>

  <div class="container">
    <div class="stats-grid">
      <div class="chart-card">
        <div class="section-title gradient-blue-pink">üìà ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</div>
        <canvas id="transportChart"></canvas>
      </div>

      <div class="chart-card">
        <div class="section-title gradient-blue-pink">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</div>
        <canvas id="gradeChart"></canvas>
      </div>
    </div>

    <!-- <div class="filter-row">
      <label for="yearFilter">‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤:</label>
      <select id="yearFilter" class="select-filter">
        <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
        <option value="2567">2567</option>
        <option value="2566">2566</option>
      </select>
    </div> -->

    <div class="stats-cards">
      <div class="card blue">
        <div class="count" id="totalCount">-</div>
        <div>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
      </div>
      <div class="card pink">
        <div class="count" id="kindergartenCount">-</div>
        <div>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•</div>
      </div>
      <div class="card purple">
        <div class="count" id="primaryCount">-</div>
        <div>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤</div>
      </div>
      <div class="card green">
        <div class="count" id="vanCount">-</div>
        <div>‡πÉ‡∏ä‡πâ‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
      </div>
    </div>
  </div>
  <div id="footer-placeholder"></div>


  <script>
    const urlGG = "https://script.google.com/macros/s/AKfycbzRB8T4-IyLuZR6Q7dJXmTdC1dqfNZSHcXnYCTZpQpahQWmfBMybyfqNfIQH105fgFc/exec";
    let transportChart, gradeChart, allData = [];

    fetch(urlGG)
      .then(res => res.json())
      .then(({
        data
      }) => {
        allData = data;
        updateCharts(data);
        document.getElementById("yearFilter").addEventListener("change", () => {
          const year = document.getElementById("yearFilter").value;
          const filtered = year === "all" ? allData : allData.filter(s => s.createdAt?.startsWith(year));
          updateCharts(filtered);
        });
      });

    function updateCharts(data) {
      const transportCounts = {};
      const gradeCounts = {};

      let kinder = 0,
        primary = 0,
        van = 0;

      data.forEach(s => {
        transportCounts[s.transportation] = (transportCounts[s.transportation] || 0) + 1;
        gradeCounts[s.grade] = (gradeCounts[s.grade] || 0) + 1;

        if (s.grade?.includes("‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•")) kinder++;
        if (s.grade?.includes("‡∏õ.")) primary++;
        if (s.transportation === "‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô") van++;
      });

      document.getElementById("totalCount").innerText = data.length;
      document.getElementById("kindergartenCount").innerText = kinder;
      document.getElementById("primaryCount").innerText = primary;
      document.getElementById("vanCount").innerText = van;

      const transportLabels = Object.keys(transportCounts);
      const transportData = Object.values(transportCounts);
      const gradeLabels = Object.keys(gradeCounts);
      const gradeData = Object.values(gradeCounts);

      if (transportChart) transportChart.destroy();
      transportChart = new Chart(document.getElementById("transportChart"), {
        type: 'pie',
        data: {
          labels: transportLabels,
          datasets: [{
            label: "‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô",
            data: transportData,
            backgroundColor: ["#4e73df", "#f48fb1", "#36b9cc", "#f6c23e", "#81c784", "#ff8a65"]
          }]
        }
      });

      if (gradeChart) gradeChart.destroy();
      gradeChart = new Chart(document.getElementById("gradeChart"), {
        type: 'bar',
        data: {
          labels: gradeLabels,
          datasets: [{
            label: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô",
            data: gradeData,
            backgroundColor: "#a78bfa"
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }
    window.addEventListener("DOMContentLoaded", () => {
      fetch("footer.html")
        .then(res => res.ok ? res.text() : Promise.reject("Footer not found"))
        .then(html => {
          document.getElementById("footer-placeholder").innerHTML = html;
        })
        .catch(err => {
          console.error("‚ö†Ô∏è Footer load error:", err);
        });
    });
  </script>
</body>

</html>